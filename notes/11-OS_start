프로그램 실행에 필요한 요소들을 시스템 자원(자원) 이라고 부른다. 즉 그동안 배운 CPU,메모리,보조기억장치, 입출력 장치는 모두 자원이다.
프로그램에 이떄 필요한 자원을 할당하고 올바르게 실행되도록 도와주는 프로그램이 운영체제이다.

운영체제 또한 프로그램이다. 그렇기에 메모리에 적재되어 있으나, 물론 매우 특별한 프로그램이기 때문에, 
메모리 내에 있는 ‘커널 영역’ 이라는 공간에 따로 적재되어 실행한다.
메모리중 커널 영역이 아닌 영역, 즉 응용프로그램이 적재되는 영역을 ‘사용자 영역’이라 한다.

예를 들어보자. 3개의 응용프로그램이 실행되고 있는 상황이다. 이 프로그램들을 각각 무조건 CPU(자원)를 필요로 할 것이다.
하지만, 이 CPU를 어떤 순서로 얼마나 사용할지에 대해 결정하고, 분배하는 것이 운영체제가 하는 일인 것이다.

운영체제는 프로그램 중 어쩌면 규모가 가장 큰 프로그램이라 볼 수 있을 것이다. 이 소스 코드들과 서비스 중에서. 자원에 접근하고, 조작하는 기능, 프로그램이 올바르고 안전하게 실행되는 것은 운영체제의 핵심일 것이다.
이러한 핵심 기능을 담당하는 부분은 ‘커널’ 이라고 따로 부른다.
운영체제가 제공하는 서비스 중, 커널에 포함되지 않는 서비스 또한 많다. 
예를 들면 사용자 인터페이스가 있다. (그래픽 유저 인터페이스, 커맨드 라인 인터페이스)


1. 이중 모드와 시스템 호출
운영체제는 반드시 어떠한 응용 프로그램이 하드웨어 자원에 직접 접근하는 것을 막고 보호한다.
즉 응용프로그램들은 자원을 이용할때는 항상 운영체제를 통해서만 접근할 수 있다.

이러한 운영체제의 문지기와 같은 역할은 이중 모드로써 구현된다.
이중모드는 CPU가 명령어를 실행하는 모드를 크게 사용자 모드와 커널 모드로 구분하는 방식이다.
사용자 모드는 운영체제 서비스를 제공받을 수 없는 실행 모드로, 커널 영역의 코드를 실행 할수 없다는 뜻이다. 대부분 응용프로그램은 기본적으로는 사용자 모드로 실행된다.
반면 커널모드는 이 반대이다. 운영체제 서비스를 제공 받을 수 있는 실행모드이다. CPU가 커널모드로 만약 명령어를 실행한다면, 자원에 접근하는 명령어를 비롯한 모든 명령어 실행이 가능하다.

그렇다면 이렇게 볼 수 있다. 기본적으로 사용자 모드로 실행되는 프로그램이 만약 자원에 접근하는 운영체제 서비스를 제공 받고 싶다..?
운영체제에 요청을 보내 ‘커널 모드’로 전환 되어야 하는 것이다.
이때의 이 요청을 ‘시스템 호출’ 이라고 한다. 어떻게 보면 이 시스템 호출은 인터럽트라고 봐도 된다.
물론 인터럽트는 입출력장치에 의해 자주 발생하기도 하지만, 이런식으로 시스템 호출과 같은, 특정 명령어에 의해 발생하기도 한다. 이를 소프트웨어 인터럽트라고 한다.

과정은 기존 장치컨트롤러가 요청하는 인터럽트와 비슷하다. 
어느 한 응용프로그램이 하드디스크에 데이터 저장을 하려 한다고 가정하자.
하드디스크는 자원이기에, 동시에 사용자 모드로 실행되어 있는 상태이므로, 먼저 하드디스크에 데이터를 저장하는 ‘시스템 호출’ 을 발생시커 커널 모드로 전환한다.
운영체제 내의 ‘하드 디스크에 데이터를 저장하는 코드’ 를 실행함으로써 하드디스크에 접근할 수 있게 된다.
그렇게 하여 접근이 끝났다면 다시 사용자 모드로 돌아간다.

비슷하다. CPU는 과정을 백업하고, 커널영역내에 시스템 호출을 수행하는 코드 (ISR) 을 실행한뒤, 기존 실행하던 응용프로그램으로 복귀하는 것이다.

2. 운영체제의 핵심 서비스
1) 프로세스 관리
프로세스는 실행 중인 프로그램을 말한다. 일반적으로 하나의 CPU는 한번에 하나의 프로세스만 실행할 수 있기에, CPU는 이 프로세스 들을 조금씩 번갈아 가며 실행한다.
또한, 프로세스들은 제각기, 사용하고자 하는 자원, 시간, 주로 사용하는 자원,  바로 실행할 수 없는 프로세스 등으로 다양한 경우가 있다.
이러한 프로세스들에 있어서 관리하고 실행 할 수 있게 하는 것이 운영체제 이다.
2) 자원 접근 및 할당
위에서 말했듯이 운영체제는 CPU 스케쥴링이 필요하다.
또한, 메모리에 적재된 프로세스 들은 크기도, 적재되는 주소도 다 다르다. 동시에 같은 프로그램이더라도, 실행되는 메모리 주소가 계속 달라질 수 있다.
이러한 ‘물리주소’에 대해서 프로세스가 메모리의 어느 주소에 적재해야 하는지 결정해주는 역할 또한 운영체제는 해야 한다.

어떻게 보면 프로세스의 논리주소에서 물리주소로 결정하는 것은 운영체제와 MMU 하드웨어 둘 다 협력해서 하는 것이다.
실제 연산은 MMU가, 기준점과 규칙은 운영체제가. 

인터럽트 서비스 루틴도 마찬가지다. 사실 ISR은 운영체제가 제공하는 기능으로 커널 영역에 있다.
장치 컨트롤러가 발생시키는 하드웨어 인터럽트도 마찬가지다. CPU가 하드웨어 인터럽트 요청 신호를 보내면, 커널에 있던 인터럽트 서비스 루틴이 실행된다.

3) 파일 시스템 관리
컴퓨터를 사용할 때는 여러 파일을 열고, 생성하고, 삭제한다. 그리고 여러 파일들을 묶어 하나의 디렉터리(폴더) 로 관리도 한다.
이것을 파일 시스템이라고 하며, 이것 또한 운영체제가 지원하는 핵심 서비스이다.


3. 가상머신과 이중 모드의 발전
이중 모드는 앞에서 말했다시피, 커널 모드와 사용자 모드를 지원하는 실행 모드이지만, 가상 머신을 통한 가상화를 지원하는 현대 CPU는 더 많은 모드를 지원한다.
가상 머신이란 말 그대로 ‘소프트웨어적’으로 만들어 낸 가상 컴퓨터 이다. 즉 ‘새로운 운영체제와 응용프로그램을 설치하고 진행 할 수 있다’

하지만 문제또한 존재한다. 예를 들어 원래 컴퓨터에는 윈도우를 쓰고 있으나, 가상 머신을 설치 및 실행하고, 그 가상 머신에 응용프로그램과, 리눅스(운영체제)를 설치했다고 치자.
그러나, ‘가상 머신’ 또한 응용 프로그램으로, 가상 머신상에 설치된 운영체제 또한 결국 커널모드가 아닌, 사용자 모드로 작동하게 된다,
즉 가상머신 내의 프로세스를 실행하는데에, 자원을 쓰기위해 커널모드로 변환하여야 하는데, 리눅스 운영체제 또한 사용자 모드이기에 제대로 커널 모드로 전환이 안된다는 것이다.

이를 해결하기위해, CPU는 커널 모드와 사용자 모드 이외의 하이퍼 바이저 모드를 따로 둔다.
이는 가상 머신에서의 작동하는 ‘응용 프로그램’ 들을 하이퍼바이저 모드로써 따로 두는 것이다. 이를 통해, 가상 머신에 설치된 운영체제로부터 운영체제 서비스를 받을 수 있게 한다.


